"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[4159],{4159:(e,t,a)=>{a.r(t),a.d(t,{PayPalCommerceAPMsPaymentMethod:()=>d,PayPalCommerceButton:()=>M,PayPalCommerceCreditButton:()=>m,PayPalCommerceCreditCardsPaymentMethod:()=>P,PayPalCommerceCreditPaymentMethod:()=>u,PayPalCommerceFastlanePaymentMethod:()=>z,PayPalCommercePaymentMethod:()=>K,PayPalCommerceVenmoPaymentMethod:()=>Y,PaypalCommerceRatePayPaymentMethod:()=>te});var n=a(70355),r=a(29345),i=a(19285),o=a(31635);const c=({method:e,checkoutService:t,paymentForm:a,onUnhandledError:r,providerOptionsKey:i,providerOptionsData:c,children:d,currentInstrument:l,language:s,shouldConfirmInstrument:m})=>{const u=(0,n.useRef)(null),y=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(!1),f=a.getFieldValue("terms"),v=a.getFieldValue("shouldSaveInstrument"),b=()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield a.validateForm();return Object.keys(e)})),g=()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(!u.current)return;(yield b()).length?u.current.disable():u.current.enable()})),E=(0,n.useCallback)((()=>{l&&!m?(a.hidePaymentSubmitButton(e,!1),h.current=!1):!h.current&&p.current&&(a.hidePaymentSubmitButton(e,!0),setTimeout((()=>{var e;null===(e=p.current)||void 0===e||e.call(p),h.current=!0}),0))}),[l]);(0,n.useEffect)((()=>{E()}),[E,p.current]),(0,n.useEffect)((()=>{g()}),[f]),(0,n.useEffect)((()=>{y.current={shouldSaveInstrument:m||Boolean(v)}}),[v,m]);return(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,[i]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{a.hidePaymentSubmitButton(e,!0)},onInit:e=>{p.current=e},submitForm:()=>{a.setSubmitted(!0),a.submitForm()},onError:t=>{a.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?r(new Error(s.translate("payment.errors.instrument_declined"))):r(t)},onValidate:(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield b();return n.length?(a.setSubmitted(!0),n.forEach((e=>a.setFieldTouched(e))),t()):e()})),onInitButton:e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){u.current=e,yield g()})),getFieldsValues:()=>y.current},c||{})})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]),d?n.createElement(n.Fragment,null,d):n.createElement(n.Fragment,null)},d=(0,i.A)((e=>{const{method:t,checkoutState:a}=e,{isPaymentDataRequired:i}=a.data,{id:o}=t;if(!i())return null;const d=(0,r.A)(o,t.gateway),l={apmFieldsContainer:`#${d}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return n.createElement(c,Object.assign({providerOptionsData:l,providerOptionsKey:"paypalcommercealternativemethods"},e),n.createElement("div",{className:`widget widget--${o} payment-widget`,id:d}))}),[{gateway:"paypalcommercealternativemethods"}]);var l=a(63582),s=a(4907);const m=(0,i.A)((e=>{const{onUnhandledError:t}=e,a={onComplete:s.A,onError:t};return n.createElement(l.A,Object.assign({additionalInitializationOptions:a},e))}),[{id:"paypalcommercecredit"}]),u=(0,i.A)((e=>{const{checkoutState:t}=e,{isPaymentDataRequired:a}=t.data;return a()?n.createElement(c,Object.assign({providerOptionsKey:"paypalcommercecredit"},e)):null}),[{id:"paypalcommercecredit"}]);var y=a(69440),p=a(14527),h=a(98363),f=a(27883),v=a(35781),b=a(66833),g=a(48407),E=a(31448),C=a(82804),I=a(53783);const P=(0,i.A)((e=>{const{checkoutService:t,checkoutState:a,paymentForm:r,language:i,method:c}=e,{cardCode:d,showCardHolderName:l,isHostedFormEnabled:s,requireCustomerCode:m}=c.config,[u,P]=(0,n.useState)(),{setFieldTouched:_,setFieldValue:S,setSubmitted:A,submitForm:w}=r,k=(0,g.A)(a),F=(0,E.A)(a),N=d||null===d,O=null==l||l,T=(0,n.useCallback)((e=>`${(0,y.compact)([c.gateway,c.id]).join("-")}-${e}`),[c]),B=(0,n.useCallback)((e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const t=["color","fontFamily","fontSize","fontWeight"],a=!!e&&F(e,c),n=!!e&&k(e,c),r=a||n;let o;return e&&r&&(o=T("ccCvv")),e||(o=T("ccNumber")),{fields:e?{cardCodeVerification:r?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:T("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r?{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:T("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:r?{accessibilityLabel:i.translate("payment.credit_card_expiry_label"),containerId:T("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:N?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:T("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:i.translate("payment.credit_card_expiration_label"),containerId:T("ccExpiry"),placeholder:i.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:i.translate("payment.credit_card_name_label"),containerId:T("ccName")},cardNumber:{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:T("ccNumber")}},styles:o?{default:yield(0,C.A)(o,t),error:yield(0,C.A)(o,t,C.S.Error),focus:yield(0,C.A)(o,t,C.S.Focus)}:{},onBlur:({fieldType:e})=>{u===e&&P(void 0)},onCardTypeChange:({cardType:e})=>{S("hostedForm.cardType",e)},onEnter:()=>{A(!0),w()},onFocus:({fieldType:e})=>{P(e)},onValidate:({errors:e={}})=>{(0,y.forIn)(e,((e,t)=>{const a=`hostedForm.errors.${t}`;S(a,e&&e[0].type?e[0].type:""),e&&e[0]&&_(a)}))}}}))),[u,T,N,O,k,F,i,c,S,_,P,A,w]),D=(0,n.useCallback)((e=>{const t=!!e&&F(e,c),a=!!e&&k(e,c),r=t||a;return n.createElement(h.A,{cardCodeId:a?T("ccCvv"):void 0,cardExpiryId:r?T("ccExpiry"):void 0,cardNumberId:t?T("ccNumber"):void 0,focusedFieldType:u})}),[u,T,k,F,c]),R=t.initializePayment,x=(0,n.useCallback)(((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return R(Object.assign(Object.assign({},e),{paypalcommercecreditcards:{form:s?yield B(t):void 0}}))}))),[B,R]);return s?n.createElement(p.A,Object.assign({},e,{cardFieldset:n.createElement(f.A,{additionalFields:m&&n.createElement(I.A,{name:"ccCustomerCode"}),cardCodeId:N?T("ccCvv"):void 0,cardExpiryId:T("ccExpiry"),cardNameId:T("ccName"),cardNumberId:T("ccNumber"),focusedFieldType:u}),cardValidationSchema:(0,v.A)({language:i}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:B,getStoredCardValidationFieldset:D,initializePayment:x,storedCardValidationSchema:(0,b.A)({language:i,isCardExpiryRequired:!0})})):n.createElement(p.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:x}))}),[{id:"paypalcommercecreditcards"}]);var _=a(94027),S=a(39981),A=a(66960),w=a(9343),k=a(68801),F=a(56943);const N=({renderPayPalCardComponent:e})=>((0,n.useEffect)((()=>{"function"==typeof e&&e("#paypal-commerce-fastlane-cc-form-container")}),[e]),n.createElement("div",{className:"paypal-commerce-fastlane-cc-form-container","data-test":"paypal-commerce-fastlane-cc-form-container",id:"paypal-commerce-fastlane-cc-form-container"}));var O=a(49655),T=a(35172),B=a(86516),D=a(63163);const R=({onChange:e,handleSelectInstrument:t,selectedInstrument:a})=>{const r=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(a.brand).toLowerCase();return n.createElement("div",{className:"paypal-commerce-fastlane-instrument","data-test":"paypal-commerce-fastlane-instrument-form"},n.createElement("div",null,n.createElement("div",{className:"paypal-commerce-fastlane-instrument-details"},n.createElement(B.A,{cardType:r}),n.createElement("div",{className:"instrumentSelect-card","data-test":"paypal-fastlane-instrument-last4"},n.createElement("span",null,"●●●● ",a.last4))),n.createElement("div",{className:"paypal-commerce-fastlane-instrument-branding"},n.createElement(T.A,null))),n.createElement("div",{className:"paypal-commerce-fastlane-instrument-change-action"},n.createElement(D.Ay,{onClick:()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof e){const a=yield e();a&&t(a)}})),size:D.Mp.Tiny,testId:"paypal-commerce-fastlane-instrument-change",variant:D.Ak.Secondary},n.createElement(O.A,{id:"common.change_action"}))))},x=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:a,handleSelectInstrument:r,selectedInstrument:i}=(()=>{const[e,t]=(0,n.useState)(),{getPaymentProviderCustomer:a}=(0,S.Q)().checkoutState.data,r=a(),i=(0,F.A)(r)?r:{},{paymentForm:o}=(0,A.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),o.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),o=a.length>0;return(0,n.useEffect)((()=>{!i&&a.length>0&&r(a[0])}),[a,i]),n.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},o&&n.createElement(R,{handleSelectInstrument:r,onChange:t,selectedInstrument:i||a[0]}),!o&&n.createElement(N,{renderPayPalCardComponent:e}))};const z=(0,i.A)((({method:e,checkoutService:t,checkoutState:a,onUnhandledError:r,paymentForm:i,language:c})=>{const d=(0,n.useRef)({}),{isLoadingPaymentMethod:l,isInitializingPayment:s}=a.statuses;(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({methodId:e.id,paypalcommercefastlane:{onInit:e=>{d.current.renderPayPalCardComponent=e},onChange:e=>{d.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(c.translate(e.translationKey)):e instanceof Error?e:new Error(c.translate("payment.errors.general_error")),r(t)}}})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]);const m=s()||l(e.id),u={isSubmitted:i.isSubmitted(),setSubmitted:i.setSubmitted};return n.createElement(w.Ay.Provider,{value:u},n.createElement(S.A.Provider,{value:{checkoutState:a,checkoutService:t}},n.createElement(_.A,{checkoutService:t},n.createElement(A.i.Provider,{value:{paymentForm:i}},n.createElement(k.A,{hideContentWhenLoading:!0,isLoading:m},n.createElement(x,{renderPayPalCardComponent:d.current.renderPayPalCardComponent,showPayPalCardSelector:d.current.showPayPalCardSelector}))))))}),[{id:"paypalcommerceacceleratedcheckout"}]),M=(0,i.A)((e=>{const{onUnhandledError:t}=e,a={onComplete:s.A,onError:t};return n.createElement(l.A,Object.assign({additionalInitializationOptions:a},e))}),[{id:"paypalcommerce"}]);var V=a(11474),j=a(40646),L=a(48447),U=a(65685);const q=e=>{const[t,a]=(0,n.useState)(),{checkoutState:r}=(0,S.Q)(),i=r.data.getCustomer(),o=r.data.getInstruments(e)||[],{paymentForm:c}=(0,A.N)(),{setFieldValue:d}=c,l=(0,n.useMemo)((()=>o.filter(U.A)),[o]),s=(0,n.useMemo)((()=>l.filter((e=>e.trustedShippingAddress))),[l]),m=l.length>0,u=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,p=u&&m,h=p&&!t,f=p&&!!t&&!s.length;(0,n.useEffect)((()=>{a(u?(()=>{if(!s.length)return;return s.filter((({defaultInstrument:e})=>e))[0]||s[0]})():void 0)}),[u,s]),(0,n.useEffect)((()=>{p||d("instrumentId","")}),[d,p]);const v=(0,n.useCallback)((e=>{a((0,y.find)(s,{bigpayToken:e})),d("instrumentId",e),d("shouldSetAsDefaultInstrument",!1)}),[s,d]),b=(0,n.useCallback)((()=>{a(void 0),d("instrumentId",""),d("shouldSaveInstrument",!1),d("shouldSetAsDefaultInstrument",!1)}),[d]);return{trustedAccountInstruments:s,currentInstrument:t,handleSelectInstrument:v,handleUseNewInstrument:b,isInstrumentFeatureAvailable:u,shouldShowInstrumentFieldset:p,shouldCreateNewInstrument:h,shouldConfirmInstrument:f}},K=(0,i.A)((e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:a,getInstruments:r},statuses:{isLoadingInstruments:i,isLoadingPaymentMethod:d}},method:{config:{isVaultingEnabled:l},initializationData:{isComplete:s}},method:m,checkoutService:u,onUnhandledError:y}=e,{trustedAccountInstruments:p,currentInstrument:h,handleSelectInstrument:f,handleUseNewInstrument:v,isInstrumentFeatureAvailable:b,shouldShowInstrumentFieldset:g,shouldConfirmInstrument:E}=q(m);if((0,n.useEffect)((()=>{const{isGuest:e}=a()||{};!e&&l&&!s&&(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield u.loadInstruments()}catch(e){e instanceof Error&&y(e)}}))}),[]),!t())return null;const C=i()||d(m.id),I=r()||[];return n.createElement(k.A,{hideContentWhenLoading:!0,isLoading:C},n.createElement(c,Object.assign({currentInstrument:h,providerOptionsKey:"paypalcommerce",shouldConfirmInstrument:E},e),g&&n.createElement(V.A,{instruments:p,onSelectInstrument:f,onUseNewInstrument:v,selectedInstrument:h}),E&&n.createElement("div",null,n.createElement(L.A,{id:"payment.account_instrument_new_shipping_address"})),b&&n.createElement(j.A,{instrumentId:null==h?void 0:h.bigpayToken,instruments:I,isAccountInstrument:!0})))}),[{id:"paypalcommerce"}]),Y=(0,i.A)((e=>{const{checkoutState:t}=e,{isPaymentDataRequired:a}=t.data;return a()?n.createElement(c,Object.assign({providerOptionsKey:"paypalcommercevenmo"},e)):null}),[{id:"paypalcommercevenmo"}]);var $=a(20874),H=a(25657),W=a(33740),G=a(41410),J=a(44218),Q=a(94202);const X=(0,J.memoize)((function({formFieldData:e,language:t}){const a={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,Q.Ik)(e.reduce(((e,{id:n,required:r})=>(r&&a[n]&&(e[n]=(0,Q.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(a[n])})),"ratepayPhoneCountryCode"===n&&(e[n]=e[n].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===n&&(e[n]=e[n].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e)),{}))})),Z="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",ee=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:W.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:W.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:W.A.TEXT}],te=(0,i.A)((({method:e,checkoutService:t,onUnhandledError:a,paymentForm:{isSubmitted:r,setFieldValue:i,setValidationSchema:c,setSubmitted:d},language:l,checkoutState:s})=>{const m=(0,n.useRef)({}),u=s.data.isPaymentDataRequired();(0,n.useEffect)((()=>((0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,paypalcommerceratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>Object.assign(Object.assign({},{ratepayBirthDate:{getDate:()=>0,getMonth:()=>0,getFullYear:()=>0},ratepayPhoneCountryCode:"",ratepayPhoneNumber:""}),m.current),onError:e=>{var t,n;const r=null===(t=e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error));if(null==r?void 0:r.length){let e,t;const i=null===(n=r[0].provider_error)||void 0===n?void 0:n.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case Z:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==Z?new H.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(l.translate(e)),a(t)}a(e)}}})}catch(e){e instanceof Error&&a(e)}})),()=>{(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&a(e)}}))})),[]);const y=(0,n.useCallback)((e=>t=>{var a;i(e,t),a={[e]:t},m.current=Object.assign(Object.assign({},m.current),a)}),[i]),p=(0,n.useMemo)((()=>X({formFieldData:ee,language:l})),[l,ee]);if((0,n.useEffect)((()=>{d(!1),c(e,p)}),[p,e,c,d]),(0,n.useEffect)((()=>{const e=(()=>{const e=s.data.getBillingAddress();if(e&&!e.country)return(0,$.B)(e.country)[0]})();e&&i("ratepayPhoneCountryCode",e.dialCode)}),[]),!u)return null;const h={isSubmitted:r(),setSubmitted:d};return n.createElement("div",{style:{marginBottom:"20px"}},n.createElement(w.Ay.Provider,{value:h},ee.map((e=>n.createElement(G.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:l.translate(e.label),onChange:y(e.id)})))))}),[{gateway:"paypalcommercealternativemethods",id:"ratepay"}])}}]);
//# sourceMappingURL=4159-8b37b591.js.map