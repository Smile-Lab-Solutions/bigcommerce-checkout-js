"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[1084],{31084:(e,t,a)=>{a.r(t),a.d(t,{BigCommercePaymentsAPMsPaymentMethod:()=>E,BigCommercePaymentsButton:()=>c,BigCommercePaymentsCreditCardsPaymentMethod:()=>T,BigCommercePaymentsFastlanePaymentMethod:()=>U,BigCommercePaymentsPayLaterPaymentMethod:()=>K,BigCommercePaymentsPaymentMethod:()=>v,BigCommercePaymentsRatePayPaymentMethod:()=>te,BigCommercePaymentsVenmoPaymentMethod:()=>$,BigcommercePaymentsPayLaterButton:()=>q});var n=a(70355),r=a(63582),i=a(19285),o=a(4907);const c=(0,i.A)((e=>{const t={onComplete:o.A,onError:e.onUnhandledError};return n.createElement(r.A,Object.assign({additionalInitializationOptions:t},e))}),[{id:"bigcommerce_payments"}]);var s=a(31635),d=a(11474),m=a(40646),l=a(48447),u=a(68801);const y=({method:e,checkoutService:t,paymentForm:a,onUnhandledError:r,providerOptionsKey:i,providerOptionsData:o,children:c,currentInstrument:d,language:m,shouldConfirmInstrument:l})=>{const u=(0,n.useRef)(null),y=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(!1),g=a.getFieldValue("terms"),b=a.getFieldValue("shouldSaveInstrument"),f=()=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield a.validateForm();return Object.keys(e)})),v=()=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){if(!u.current)return;(yield f()).length?u.current.disable():u.current.enable()})),_=(0,n.useCallback)((()=>{d&&!l?(a.hidePaymentSubmitButton(e,!1),h.current=!1):!h.current&&p.current&&(a.hidePaymentSubmitButton(e,!0),setTimeout((()=>{var e;null===(e=p.current)||void 0===e||e.call(p),h.current=!0}),0))}),[d]);(0,n.useEffect)((()=>{_()}),[_,p.current]),(0,n.useEffect)((()=>{v()}),[g]),(0,n.useEffect)((()=>{y.current={shouldSaveInstrument:l||Boolean(b)}}),[b,l]);return(0,n.useEffect)((()=>((0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,[i]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{a.hidePaymentSubmitButton(e,!0)},onInit:e=>{p.current=e},submitForm:()=>{a.setSubmitted(!0),a.submitForm()},onError:t=>{a.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?r(new Error(m.translate("payment.errors.instrument_declined"))):r(t)},onValidate:(e,t)=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield f();return n.length?(a.setSubmitted(!0),n.forEach((e=>a.setFieldTouched(e))),t()):e()})),onInitButton:e=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){u.current=e,yield v()})),getFieldsValues:()=>y.current},o||{})})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]),c?n.createElement(n.Fragment,null,c):n.createElement(n.Fragment,null)};var p=a(69440),h=a(65685),g=a(39981),b=a(66960);const f=e=>{const[t,a]=(0,n.useState)(),{checkoutState:r}=(0,g.Q)(),i=r.data.getCustomer(),o=r.data.getInstruments(e)||[],{paymentForm:c}=(0,b.N)(),{setFieldValue:s}=c,d=(0,n.useMemo)((()=>o.filter(h.A)),[o]),m=(0,n.useMemo)((()=>d.filter((e=>e.trustedShippingAddress))),[d]),l=d.length>0,u=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,y=u&&l,f=y&&!t,v=y&&!!t&&!m.length;(0,n.useEffect)((()=>{a(u?(()=>{if(!m.length)return;return m.filter((({defaultInstrument:e})=>e))[0]||m[0]})():void 0)}),[u,m]),(0,n.useEffect)((()=>{y||s("instrumentId","")}),[s,y]);const _=(0,n.useCallback)((e=>{a((0,p.find)(m,{bigpayToken:e})),s("instrumentId",e),s("shouldSetAsDefaultInstrument",!1)}),[m,s]),E=(0,n.useCallback)((()=>{a(void 0),s("instrumentId",""),s("shouldSaveInstrument",!1),s("shouldSetAsDefaultInstrument",!1)}),[s]);return{trustedAccountInstruments:m,currentInstrument:t,handleSelectInstrument:_,handleUseNewInstrument:E,isInstrumentFeatureAvailable:u,shouldShowInstrumentFieldset:y,shouldCreateNewInstrument:f,shouldConfirmInstrument:v}},v=(0,i.A)((e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:a,getInstruments:r},statuses:{isLoadingInstruments:i,isLoadingPaymentMethod:o}}}=e,c=e.method,{config:{isVaultingEnabled:p}}=c,h=(0,s.__rest)(c.initializationData,[]),{method:g,checkoutService:b,onUnhandledError:v}=e,{trustedAccountInstruments:_,currentInstrument:E,handleSelectInstrument:C,handleUseNewInstrument:I,isInstrumentFeatureAvailable:P,shouldShowInstrumentFieldset:S,shouldConfirmInstrument:A}=f(g);if((0,n.useEffect)((()=>{const{isGuest:e}=a()||{};!e&&p&&!h&&(0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield b.loadInstruments()}catch(e){e instanceof Error&&v(e)}}))})),!t())return null;const w=i()||o(g.id),k=r()||[];return n.createElement(u.A,{hideContentWhenLoading:!0,isLoading:w},n.createElement(y,Object.assign({currentInstrument:E,providerOptionsKey:"bigcommerce_payments",shouldConfirmInstrument:A},e),S&&n.createElement(d.A,{instruments:_,onSelectInstrument:C,onUseNewInstrument:I,selectedInstrument:E}),A&&n.createElement("div",null,n.createElement(l.A,{id:"payment.account_instrument_new_shipping_address"})),P&&n.createElement(m.A,{instrumentId:null==E?void 0:E.bigpayToken,instruments:k,isAccountInstrument:!0})))}),[{id:"bigcommerce_payments"}]);var _=a(29345);const E=(0,i.A)((e=>{const{method:t,checkoutState:a}=e;if(!a.data.isPaymentDataRequired())return null;const r=(0,_.A)(t.id,t.gateway),i={apmFieldsContainer:`#${r}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return n.createElement(y,Object.assign({providerOptionsData:i,providerOptionsKey:"bigcommerce_payments_apms"},e),n.createElement("div",{className:`widget widget--${t.id} payment-widget`,id:r}))}),[{gateway:"bigcommerce_payments_apms"}]);var C=a(14527),I=a(98363),P=a(27883),S=a(35781),A=a(66833),w=a(48407),k=a(31448),F=a(82804),N=a(53783);const T=(0,i.A)((e=>{const{checkoutService:t,checkoutState:a,paymentForm:r,language:i,method:o}=e,{cardCode:c,showCardHolderName:d,isHostedFormEnabled:m,requireCustomerCode:l}=o.config,[u,y]=(0,n.useState)(),{setFieldTouched:h,setFieldValue:g,setSubmitted:b,submitForm:f}=r,v=(0,w.A)(a),_=(0,k.A)(a),E=c||null===c,T=null==d||d,O=(0,n.useCallback)((e=>`${(0,p.compact)([o.gateway,o.id]).join("-")}-${e}`),[o]),B=(0,n.useCallback)((e=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){const t=["color","fontFamily","fontSize","fontWeight"],a=!!e&&_(e,o),n=!!e&&v(e,o),r=a||n;let c;return e&&r&&(c=O("ccCvv")),e||(c=O("ccNumber")),{fields:e?{cardCodeVerification:r?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:O("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r?{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:O("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:r?{accessibilityLabel:i.translate("payment.credit_card_expiry_label"),containerId:O("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:E?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:O("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:i.translate("payment.credit_card_expiration_label"),containerId:O("ccExpiry"),placeholder:i.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:i.translate("payment.credit_card_name_label"),containerId:O("ccName")},cardNumber:{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:O("ccNumber")}},styles:c?{default:yield(0,F.A)(c,t),error:yield(0,F.A)(c,t,F.S.Error),focus:yield(0,F.A)(c,t,F.S.Focus)}:{},onBlur:({fieldType:e})=>{u===e&&y(void 0)},onCardTypeChange:({cardType:e})=>{g("hostedForm.cardType",e)},onEnter:()=>{b(!0),f()},onFocus:({fieldType:e})=>{y(e)},onValidate:({errors:e={}})=>{(0,p.forIn)(e,((e,t)=>{const a=`hostedForm.errors.${t}`;g(a,e&&e[0].type?e[0].type:""),e&&e[0]&&h(a)}))}}}))),[u,O,E,T,v,_,i,o,g,h,y,b,f]),R=(0,n.useCallback)((e=>{const t=!!e&&_(e,o),a=!!e&&v(e,o),r=t||a;return n.createElement(I.A,{cardCodeId:a?O("ccCvv"):void 0,cardExpiryId:r?O("ccExpiry"):void 0,cardNumberId:t?O("ccNumber"):void 0,focusedFieldType:u})}),[u,O,v,_,o]),D=t.initializePayment,x=(0,n.useCallback)(((e,t)=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){return D(Object.assign(Object.assign({},e),{bigcommerce_payments_creditcards:{form:m?yield B(t):void 0}}))}))),[B,D]);return m?n.createElement(C.A,Object.assign({},e,{cardFieldset:n.createElement(P.A,{additionalFields:l&&n.createElement(N.A,{name:"ccCustomerCode"}),cardCodeId:E?O("ccCvv"):void 0,cardExpiryId:O("ccExpiry"),cardNameId:O("ccName"),cardNumberId:O("ccNumber"),focusedFieldType:u}),cardValidationSchema:(0,S.A)({language:i}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:B,getStoredCardValidationFieldset:R,initializePayment:x,storedCardValidationSchema:(0,A.A)({language:i,isCardExpiryRequired:!0})})):n.createElement(C.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:x}))}),[{id:"bigcommerce_payments_creditcards"}]);var O=a(94027),B=a(9343),R=a(56943);const D=({renderPayPalCardComponent:e})=>((0,n.useEffect)((()=>{"function"==typeof e&&e("#big-commerce-payments-fastlane-cc-form-container")}),[e]),n.createElement("div",{className:"big-commerce-payments-fastlane-cc-form-container","data-test":"big-commerce-payments-fastlane-cc-form-container",id:"big-commerce-payments-fastlane-cc-form-container"}));var x=a(49655),z=a(35172),M=a(86516),V=a(63163);const L=({onChange:e,handleSelectInstrument:t,selectedInstrument:a})=>{const r=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(a.brand).toLowerCase();return n.createElement("div",{className:"big-commerce-payments-fastlane-instrument","data-test":"big-commerce-payments-fastlane-instrument-form"},n.createElement("div",null,n.createElement("div",{className:"big-commerce-payments-fastlane-instrument-details"},n.createElement(M.A,{cardType:r}),n.createElement("div",{className:"instrumentSelect-card","data-test":"big-commerce-fastlane-instrument-last4"},n.createElement("span",null,"●●●● ",a.last4))),n.createElement("div",{className:"big-commerce-payments-fastlane-instrument-branding"},n.createElement(z.A,null))),n.createElement("div",{className:"big-commerce-payments-fastlane-instrument-change-action"},n.createElement(V.Ay,{onClick:()=>(0,s.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof e){const a=yield e();a&&t(a)}})),size:V.Mp.Tiny,testId:"big-commerce-payments-fastlane-instrument-change",variant:V.Ak.Secondary},n.createElement(x.A,{id:"common.change_action"}))))},j=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:a,handleSelectInstrument:r,selectedInstrument:i}=(()=>{const[e,t]=(0,n.useState)(),{getPaymentProviderCustomer:a}=(0,g.Q)().checkoutState.data,r=a(),i=(0,R.A)(r)?r:{},{paymentForm:o}=(0,b.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),o.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),o=a.length>0;return(0,n.useEffect)((()=>{!i&&a.length>0&&r(a[0])}),[a,i,r]),n.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},o&&n.createElement(L,{handleSelectInstrument:r,onChange:t,selectedInstrument:i||a[0]}),!o&&n.createElement(D,{renderPayPalCardComponent:e}))};const U=(0,i.A)((({method:e,checkoutService:t,checkoutState:a,onUnhandledError:r,paymentForm:i,language:o})=>{const c=(0,n.useRef)({}),{isLoadingPaymentMethod:d,isInitializingPayment:m}=a.statuses;(0,n.useEffect)((()=>((0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({methodId:e.id,bigcommerce_payments_fastlane:{onInit:e=>{c.current.renderPayPalCardComponent=e},onChange:e=>{c.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(o.translate(e.translationKey)):e instanceof Error?e:new Error(o.translate("payment.errors.general_error")),r(t)}}})}catch(e){e instanceof Error&&r(e)}})),()=>{(0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&r(e)}}))})),[]);const l=m()||d(e.id),y={isSubmitted:i.isSubmitted(),setSubmitted:i.setSubmitted};return n.createElement(B.Ay.Provider,{value:y},n.createElement(g.A.Provider,{value:{checkoutState:a,checkoutService:t}},n.createElement(O.A,{checkoutService:t},n.createElement(b.i.Provider,{value:{paymentForm:i}},n.createElement(u.A,{hideContentWhenLoading:!0,isLoading:l},n.createElement(j,{renderPayPalCardComponent:c.current.renderPayPalCardComponent,showPayPalCardSelector:c.current.showPayPalCardSelector}))))))}),[{id:"bigcommerce_payments_fastlane"}]),q=(0,i.A)((e=>{const t={onComplete:o.A,onError:e.onUnhandledError};return n.createElement(r.A,Object.assign({additionalInitializationOptions:t},e))}),[{id:"bigcommerce_payments_paylater"}]),K=(0,i.A)((e=>{const{checkoutState:t}=e;return t.data.isPaymentDataRequired()?n.createElement(y,Object.assign({providerOptionsKey:"bigcommerce_payments_paylater"},e)):null}),[{id:"bigcommerce_payments_paylater"}]),$=(0,i.A)((e=>e.checkoutState.data.isPaymentDataRequired()?n.createElement(y,Object.assign({providerOptionsKey:"bigcommerce_payments_venmo"},e)):null),[{id:"bigcommerce_payments_venmo"}]);var Y=a(20874),H=a(25657),W=a(33740),G=a(41410),J=a(44218),Q=a(94202);const X=(0,J.memoize)((function({formFieldData:e,language:t}){const a={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,Q.Ik)(e.reduce(((e,{id:n,required:r})=>(r&&a[n]&&(e[n]=(0,Q.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(a[n])})),"ratepayPhoneCountryCode"===n&&(e[n]=e[n].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===n&&(e[n]=e[n].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e)),{}))})),Z="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",ee=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:W.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:W.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:W.A.TEXT}],te=(0,i.A)((({method:e,checkoutService:t,onUnhandledError:a,paymentForm:{isSubmitted:r,setFieldValue:i,setValidationSchema:o,setSubmitted:c},language:d,checkoutState:m})=>{const l=(0,n.useRef)({}),u=m.data.isPaymentDataRequired();if(!u)return null;(0,n.useEffect)((()=>((0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,bigcommerce_payments_ratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>l.current,onError:e=>{var t,n;const r=null===(t=e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error));if(null==r?void 0:r.length){let e,t;const i=null===(n=r[0].provider_error)||void 0===n?void 0:n.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case Z:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==Z?new H.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(d.translate(e)),a(t)}a(e)}}})}catch(e){e instanceof Error&&a(e)}})),()=>{(0,s.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&a(e)}}))})),[]);const y=(0,n.useCallback)((e=>t=>{var a;i(e,t),a={[e]:t},l.current=Object.assign(Object.assign({},l.current),a)}),[i]),p=(0,n.useMemo)((()=>X({formFieldData:ee,language:d})),[d,ee]);return(0,n.useEffect)((()=>{c(!1),o(e,p)}),[p,e,o,c]),(0,n.useEffect)((()=>{i("ratepayPhoneCountryCode",(()=>{const e=m.data.getBillingAddress();return(0,Y.B)(e.country)[0]||""})().dialCode)}),[]),n.createElement("div",{style:{marginBottom:"20px"}},n.createElement(B.Ay.Provider,{value:{isSubmitted:r,setSubmitted:c}},ee.map((e=>n.createElement(G.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:d.translate(e.label),onChange:y(e.id)})))))}),[{gateway:"bigcommerce_payments_apms",id:"ratepay"}])}}]);
//# sourceMappingURL=1084-ebcba054.js.map